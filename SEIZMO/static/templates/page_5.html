{% block content %}

<style>
    /* (스타일은 이전과 동일) */
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    body {
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background-color: #f7f7f7;
    }
    .full-screen-container {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .full-screen-image {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
</style>

<body>
    <div class="full-screen-container">
         <img src="./static/assets/5.png" class="full-screen-image" alt="변환 중 화면">
    </div>

    <script>
        // 페이지가 로드되자마자 이 함수를 실행합니다.
        window.onload = function() {
            console.log("page_5.html loaded. Starting swap process...");

            // 1. 서버에 '/perform_swap' (합성 실행)을 POST로 요청합니다.
            fetch('/perform_swap', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
                // body는 비워둡니다 (모든 데이터는 서버 세션에 있습니다)
            })
            .then(response => response.json()) // 2. 서버의 응답(JSON)을 받습니다.
            .then(data => {
                // 3. 서버가 'success'를 반환하면,
                if (data.status === 'success') {
                    // 4. 결과 페이지(page_6)로 이동합니다.
                    console.log("Swap success. Redirecting to page_6.");
                    window.location.href = data.redirect_url;
                } else {
                    // 5. 에러가 발생하면, 에러 메시지와 함께 page_4로 돌려보냅니다.
                    console.error("Swap failed:", data.message);
                    alert('오류가 발생했습니다: ' + data.message);
                    window.location.href = data.redirect_url;
                }
            })
            .catch(error => {
                // 6. 심각한 네트워크 오류 등
                console.error("Swap fetch error:", error);
                alert('합성 요청에 실패했습니다. 네트워크를 확인하세요.');
                window.location.href = "{{ url_for('page_4') }}";
            });
        };
    </script>
</body>

{% endblock %}